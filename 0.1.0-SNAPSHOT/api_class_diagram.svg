<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="557px" preserveAspectRatio="none" style="width:1271px;height:557px;background:#FFFFFF;" version="1.1" viewBox="0 0 1271 557" width="1271px" zoomAndPan="magnify"><defs><filter height="1" id="b1mdh2wd3njik50" width="1" x="0" y="0"><feFlood flood-color="#FFFF00" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter></defs><g><rect fill="none" height="25.6406" id="_title" style="stroke:none;stroke-width:1.0;" width="539" x="359" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="529" x="364" y="22.6738">Calypsonet - calypsonet-terminal-calypso-crypto-java-api - 0.1.+ (2022-11-04)</text><rect fill="#DDDDDD" height="56.9219" id="_legend" rx="7.5" ry="7.5" style="stroke:#000000;stroke-width:1.0;" width="282" x="487.5" y="48.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="88" x="492.5" y="66.3145">Colors legend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="584.5" y="66.3145">:</text><ellipse cx="498" cy="77.4219" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="189" x="504.5" y="81.9551">External public API references</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="697.5" y="81.9551">:</text><rect fill="#000000" height="3.5" style="stroke:#000000;stroke-width:0.0;" width="3.5" x="501.5" y="90.5625"/><text fill="#000000" filter="url(#b1mdh2wd3njik50)" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="256" x="508.5" y="97.5957">calypsonet-terminal-calypso-java-api</text><!--MD5=[7442f3b126ee602ae02566c1a49e158a]
cluster api--><g id="cluster_api"><path d="M8.5,124.5625 L279.5,124.5625 A3.75,3.75 0 0 1 282,127.0625 L289,146.2031 L1261.5,146.2031 A2.5,2.5 0 0 1 1264,148.7031 L1264,548.0625 A2.5,2.5 0 0 1 1261.5,550.5625 L8.5,550.5625 A2.5,2.5 0 0 1 6,548.0625 L6,127.0625 A2.5,2.5 0 0 1 8.5,124.5625 " fill="#F8F9F9" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="289" y1="146.2031" y2="146.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="270" x="10" y="139.2363">org.calypsonet.terminal.calypso.crypto</text></g><!--MD5=[e49d7c19785922197ab1aa08e3f07a61]
class CardCryptoServiceSpi--><g id="elem_CardCryptoServiceSpi"><rect codeLine="61" fill="#FEFECE" height="376.4531" id="CardCryptoServiceSpi" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="663" x="584.5" y="158.5625"/><ellipse cx="836.75" cy="174.5625" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M837.7031,171.2031 L837.7031,177.8594 L839.4219,177.8594 Q840.0313,177.8594 840.2969,178.0938 Q840.5625,178.3281 840.5625,178.7188 Q840.5625,179.0938 840.2969,179.3281 Q840.0313,179.5625 839.4219,179.5625 L834.2813,179.5625 Q833.6719,179.5625 833.4063,179.3281 Q833.1406,179.0938 833.1406,178.7031 Q833.1406,178.3281 833.4063,178.0938 Q833.6719,177.8594 834.2813,177.8594 L836,177.8594 L836,171.2031 L834.2813,171.2031 Q833.6719,171.2031 833.4063,170.9688 Q833.1406,170.7344 833.1406,170.3438 Q833.1406,169.9688 833.4063,169.7344 Q833.6719,169.5 834.2813,169.5 L839.4219,169.5 Q840.0313,169.5 840.2969,169.7344 Q840.5625,169.9688 840.5625,170.3438 Q840.5625,170.7344 840.2969,170.9688 Q840.0313,171.2031 839.4219,171.2031 L837.7031,171.2031 Z " fill="#000000"/><ellipse cx="862.25" cy="174.0625" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="139" x="868.25" y="179.416">CardCryptoServiceSpi</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="585.5" x2="1246.5" y1="190.5625" y2="190.5625"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="585.5" x2="1246.5" y1="198.5625" y2="198.5625"/><ellipse cx="595.5" cy="211.8828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="274" x="604.5" y="215.2363">void setKeyDiversifier (byte[] keyDiversifier)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="230.877"> </text><ellipse cx="595.5" cy="243.1641" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269" x="604.5" y="246.5176">byte[] initTerminalSecureSessionContext ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="262.1582"> </text><ellipse cx="595.5" cy="274.4453" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="525" x="604.5" y="277.7988">void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)</text><ellipse cx="595.5" cy="290.0859" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="299" x="604.5" y="293.4395">byte[] updateTerminalSessionMac (byte[] apdu)</text><ellipse cx="595.5" cy="305.7266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="227" x="604.5" y="309.0801">byte[] finalizeTerminalSessionMac ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="324.7207"> </text><ellipse cx="595.5" cy="337.0078" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241" x="604.5" y="340.3613">byte[] generateTerminalSessionMac ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="356.002"> </text><ellipse cx="595.5" cy="368.2891" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="604.5" y="371.6426">void activateEncryption()</text><ellipse cx="595.5" cy="383.9297" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="604.5" y="387.2832">void deactivateEncryption()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="402.9238"> </text><ellipse cx="595.5" cy="415.2109" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="353" x="604.5" y="418.5645">boolean verifyCardSessionMac (byte[] cardSessionMac)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="434.2051"> </text><ellipse cx="595.5" cy="446.4922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="586" x="604.5" y="449.8457">void generateSvCommandSecurityData (SvCommandSecurityData svCommandSecurityData)</text><ellipse cx="595.5" cy="462.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="285" x="604.5" y="465.4863">boolean verifyCardSvMac (byte[] cardSvMac)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="604.5" y="481.127"> </text><ellipse cx="595.5" cy="493.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="385" x="604.5" y="496.7676">byte[] cipherPinForPresentation (byte[] pin, byte kif, byte kvc)</text><ellipse cx="595.5" cy="509.0547" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="518" x="604.5" y="512.4082">byte[] cipherPinForModification (byte[] currentPin, byte[] newPin, byte kif, byte kvc)</text><ellipse cx="595.5" cy="524.6953" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="637" x="604.5" y="528.0488">byte[] generateCardKey (byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)</text></g><!--MD5=[bfb5523aa309801156f1e6f13a5ea6af]
class SvCommandSecurityData--><g id="elem_SvCommandSecurityData"><rect codeLine="85" fill="#FEFECE" height="173.125" id="SvCommandSecurityData" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="527" x="22.5" y="260.0625"/><ellipse cx="196.25" cy="276.0625" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M197.2031,272.7031 L197.2031,279.3594 L198.9219,279.3594 Q199.5313,279.3594 199.7969,279.5938 Q200.0625,279.8281 200.0625,280.2188 Q200.0625,280.5938 199.7969,280.8281 Q199.5313,281.0625 198.9219,281.0625 L193.7813,281.0625 Q193.1719,281.0625 192.9063,280.8281 Q192.6406,280.5938 192.6406,280.2031 Q192.6406,279.8281 192.9063,279.5938 Q193.1719,279.3594 193.7813,279.3594 L195.5,279.3594 L195.5,272.7031 L193.7813,272.7031 Q193.1719,272.7031 192.9063,272.4688 Q192.6406,272.2344 192.6406,271.8438 Q192.6406,271.4688 192.9063,271.2344 Q193.1719,271 193.7813,271 L198.9219,271 Q199.5313,271 199.7969,271.2344 Q200.0625,271.4688 200.0625,271.8438 Q200.0625,272.2344 199.7969,272.4688 Q199.5313,272.7031 198.9219,272.7031 L197.2031,272.7031 Z " fill="#000000"/><ellipse cx="221.75" cy="275.5625" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="160" x="227.75" y="280.916">SvCommandSecurityData</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="23.5" x2="548.5" y1="292.0625" y2="292.0625"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="23.5" x2="548.5" y1="300.0625" y2="300.0625"/><ellipse cx="33.5" cy="313.3828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="419" x="42.5" y="316.7363">SvCommandSecurityData setSvGetRequest (byte[] svGetRequest)</text><ellipse cx="33.5" cy="329.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="42.5" y="332.377">SvCommandSecurityData setSvGetResponse (byte[] svGetResponse)</text><ellipse cx="33.5" cy="344.6641" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="501" x="42.5" y="348.0176">SvCommandSecurityData setSvCommandRequest (byte[] svCommandRequest)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="42.5" y="363.6582"> </text><ellipse cx="33.5" cy="375.9453" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="42.5" y="379.2988">byte[] getSerialNumber ()</text><ellipse cx="33.5" cy="391.5859" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197" x="42.5" y="394.9395">byte[] getTransactionNumber ()</text><ellipse cx="33.5" cy="407.2266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="42.5" y="410.5801">byte[] getTerminalChallenge ()</text><ellipse cx="33.5" cy="422.8672" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="42.5" y="426.2207">byte[] getTerminalSvMac ()</text></g><!--MD5=[40860e754183432160d56d5901794ad5]
@startuml
title
    Calypsonet - calypsonet-terminal-calypso-crypto-java-api - 0.1.+ (2022-11-04)
end title

' == THEME ==

'Couleurs issues de : https://htmlcolorcodes.com/fr/tableau-de-couleur/tableau-de-couleur-design-plat/
!define C_GREY1 F8F9F9
!define C_GREY2 F2F3F4
!define C_GREY3 E5E7E9
!define C_GREY4 D7DBDD
!define C_GREY5 CACFD2
!define C_GREY6 BDC3C7
!define C_LINK 3498DB
!define C_USE 27AE60

' - - Styles that don't work with new version of plantuml - -
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
' - - END - -

skinparam ClassBorderThickness 2
skinparam ArrowThickness 2

' Yellow
skinparam ClassBackgroundColor #FEFECE
skinparam ClassBorderColor #D4AC0D
' Red
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
' Purple
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
' blue
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
' Green
skinparam ClassBackgroundColor<<green>> #E9F7EF
skinparam ClassBorderColor<<green>> #27AE60
hide <<green>> stereotype
' Grey
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

' == CONTENT ==

legend top
    __Colors legend__ :
    * __External public API references__ :
    ** <back:yellow>**calypsonet-terminal-calypso-java-api**</back>
end legend

package "org.calypsonet.terminal.calypso.crypto" as api {
    ' https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/HowToImplAProvider.html#Engine
    +interface CardCryptoServiceSpi {
        +void setKeyDiversifier (byte[] keyDiversifier)

        +byte[] initTerminalSecureSessionContext ()

        +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)
        +byte[] updateTerminalSessionMac (byte[] apdu)
        +byte[] finalizeTerminalSessionMac ()

        +byte[] generateTerminalSessionMac ()

        +void activateEncryption()
        +void deactivateEncryption()

        +boolean verifyCardSessionMac (byte[] cardSessionMac)

        +void generateSvCommandSecurityData (SvCommandSecurityData svCommandSecurityData)
        +boolean verifyCardSvMac (byte[] cardSvMac)

        +byte[] cipherPinForPresentation (byte[] pin, byte kif, byte kvc)
        +byte[] cipherPinForModification (byte[] currentPin, byte[] newPin, byte kif, byte kvc)
        +byte[] generateCardKey (byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)
    }

    +interface SvCommandSecurityData {
        +SvCommandSecurityData setSvGetRequest (byte[] svGetRequest)
        +SvCommandSecurityData setSvGetResponse (byte[] svGetResponse)
        +SvCommandSecurityData setSvCommandRequest (byte[] svCommandRequest)

        +byte[] getSerialNumber ()
        +byte[] getTransactionNumber ()
        +byte[] getTerminalChallenge ()
        +byte[] getTerminalSvMac ()
    }
}

' Associations

' == LAYOUT ==

'CardSecuritySetting -[hidden]- CalypsoSam

' == STYLE ==

package api #C_GREY1 {}

@enduml

@startuml
title
    Calypsonet - calypsonet-terminal-calypso-crypto-java-api - 0.1.+ (2022-11-04)
end title



skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF

skinparam ClassBorderThickness 2
skinparam ArrowThickness 2

skinparam ClassBackgroundColor #FEFECE
skinparam ClassBorderColor #D4AC0D
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
skinparam ClassBackgroundColor<<green>> #E9F7EF
skinparam ClassBorderColor<<green>> #27AE60
hide <<green>> stereotype
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype


legend top
    __Colors legend__ :
    * __External public API references__ :
    ** <back:yellow>**calypsonet-terminal-calypso-java-api**</back>
end legend

package "org.calypsonet.terminal.calypso.crypto" as api {
    +interface CardCryptoServiceSpi {
        +void setKeyDiversifier (byte[] keyDiversifier)

        +byte[] initTerminalSecureSessionContext ()

        +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)
        +byte[] updateTerminalSessionMac (byte[] apdu)
        +byte[] finalizeTerminalSessionMac ()

        +byte[] generateTerminalSessionMac ()

        +void activateEncryption()
        +void deactivateEncryption()

        +boolean verifyCardSessionMac (byte[] cardSessionMac)

        +void generateSvCommandSecurityData (SvCommandSecurityData svCommandSecurityData)
        +boolean verifyCardSvMac (byte[] cardSvMac)

        +byte[] cipherPinForPresentation (byte[] pin, byte kif, byte kvc)
        +byte[] cipherPinForModification (byte[] currentPin, byte[] newPin, byte kif, byte kvc)
        +byte[] generateCardKey (byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)
    }

    +interface SvCommandSecurityData {
        +SvCommandSecurityData setSvGetRequest (byte[] svGetRequest)
        +SvCommandSecurityData setSvGetResponse (byte[] svGetResponse)
        +SvCommandSecurityData setSvCommandRequest (byte[] svCommandRequest)

        +byte[] getSerialNumber ()
        +byte[] getTransactionNumber ()
        +byte[] getTerminalChallenge ()
        +byte[] getTerminalSvMac ()
    }
}





package api #F8F9F9 {}

@enduml

PlantUML version 1.2022.12(Sun Oct 23 20:12:26 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="862px" preserveAspectRatio="none" style="width:1651px;height:862px;background:#FFFFFF;" version="1.1" viewBox="0 0 1651 862" width="1651px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="25.6406" id="_title" style="stroke:none;stroke-width:1.0;" width="615" x="511" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="605" x="516" y="22.6738">Calypsonet - calypsonet-terminal-calypso-crypto-symmetric-java-api - 0.1.+ (2022-11-29)</text><!--MD5=[7442f3b126ee602ae02566c1a49e158a]
cluster api--><g id="cluster_api"><path d="M8.5,42.6406 L354.5,42.6406 A3.75,3.75 0 0 1 357,45.1406 L364,64.2813 L1641.5,64.2813 A2.5,2.5 0 0 1 1644,66.7813 L1644,853.1406 A2.5,2.5 0 0 1 1641.5,855.6406 L8.5,855.6406 A2.5,2.5 0 0 1 6,853.1406 L6,45.1406 A2.5,2.5 0 0 1 8.5,42.6406 " fill="#F8F9F9" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="364" y1="64.2813" y2="64.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="345" x="10" y="57.3145">org.calypsonet.terminal.calypso.crypto.symmetric</text></g><!--MD5=[f7e0e2453c87923036c1ac2adfb9cbf0]
cluster spi--><g id="cluster_spi"><path d="M566.5,84.6406 L588.5,84.6406 A3.75,3.75 0 0 1 591,87.1406 L598,106.2813 L1617.5,106.2813 A2.5,2.5 0 0 1 1620,108.7813 L1620,829.1406 A2.5,2.5 0 0 1 1617.5,831.6406 L566.5,831.6406 A2.5,2.5 0 0 1 564,829.1406 L564,87.1406 A2.5,2.5 0 0 1 566.5,84.6406 " fill="#F2F3F4" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="564" x2="598" y1="106.2813" y2="106.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="21" x="568" y="99.3145">spi</text></g><!--MD5=[b603a74dfece547939852eca9002246b]
class SvCommandSecurityDataApi--><g id="elem_SvCommandSecurityDataApi"><rect codeLine="147" fill="#F4ECF7" height="173.125" id="SvCommandSecurityDataApi" rx="2.5" ry="2.5" style="stroke:#8E44AD;stroke-width:2.0;" width="526" x="22" y="391.1406"/><ellipse cx="185.25" cy="407.1406" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M186.2031,403.7813 L186.2031,410.4375 L187.9219,410.4375 Q188.5313,410.4375 188.7969,410.6719 Q189.0625,410.9063 189.0625,411.2969 Q189.0625,411.6719 188.7969,411.9063 Q188.5313,412.1406 187.9219,412.1406 L182.7813,412.1406 Q182.1719,412.1406 181.9063,411.9063 Q181.6406,411.6719 181.6406,411.2813 Q181.6406,410.9063 181.9063,410.6719 Q182.1719,410.4375 182.7813,410.4375 L184.5,410.4375 L184.5,403.7813 L182.7813,403.7813 Q182.1719,403.7813 181.9063,403.5469 Q181.6406,403.3125 181.6406,402.9219 Q181.6406,402.5469 181.9063,402.3125 Q182.1719,402.0781 182.7813,402.0781 L187.9219,402.0781 Q188.5313,402.0781 188.7969,402.3125 Q189.0625,402.5469 189.0625,402.9219 Q189.0625,403.3125 188.7969,403.5469 Q188.5313,403.7813 187.9219,403.7813 L186.2031,403.7813 Z " fill="#000000"/><ellipse cx="210.75" cy="406.6406" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="180" x="216.75" y="411.9941">SvCommandSecurityDataApi</text><line style="stroke:#8E44AD;stroke-width:2.0;" x1="23" x2="547" y1="423.1406" y2="423.1406"/><line style="stroke:#8E44AD;stroke-width:2.0;" x1="23" x2="547" y1="431.1406" y2="431.1406"/><ellipse cx="33" cy="444.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="42" y="447.8145">byte[] getSvGetRequest ()</text><ellipse cx="33" cy="460.1016" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="42" y="463.4551">byte[] getSvGetResponse ()</text><ellipse cx="33" cy="475.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="246" x="42" y="479.0957">byte[] getSvCommandPartialRequest ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="42" y="494.7363"> </text><ellipse cx="33" cy="507.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="425" x="42" y="510.377">SvCommandSecurityDataApi setSerialNumber (byte[] serialNumber)</text><ellipse cx="33" cy="522.6641" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="500" x="42" y="526.0176">SvCommandSecurityDataApi setTransactionNumber (byte[] transactionNumber)</text><ellipse cx="33" cy="538.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="490" x="42" y="541.6582">SvCommandSecurityDataApi setTerminalChallenge (byte[] terminalChallenge)</text><ellipse cx="33" cy="553.9453" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="446" x="42" y="557.2988">SvCommandSecurityDataApi setTerminalSvMac (byte[] terminalSvMac)</text></g><!--MD5=[bb3fae334104f06ba0a4414ece7963c2]
class SymmetricCryptoTransactionManagerFactorySpi--><g id="elem_SymmetricCryptoTransactionManagerFactorySpi"><rect codeLine="55" fill="#FEFECE" height="94.9219" id="SymmetricCryptoTransactionManagerFactorySpi" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="1024" x="580" y="118.6406"/><ellipse cx="928.75" cy="134.6406" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M929.7031,131.2813 L929.7031,137.9375 L931.4219,137.9375 Q932.0313,137.9375 932.2969,138.1719 Q932.5625,138.4063 932.5625,138.7969 Q932.5625,139.1719 932.2969,139.4063 Q932.0313,139.6406 931.4219,139.6406 L926.2813,139.6406 Q925.6719,139.6406 925.4063,139.4063 Q925.1406,139.1719 925.1406,138.7813 Q925.1406,138.4063 925.4063,138.1719 Q925.6719,137.9375 926.2813,137.9375 L928,137.9375 L928,131.2813 L926.2813,131.2813 Q925.6719,131.2813 925.4063,131.0469 Q925.1406,130.8125 925.1406,130.4219 Q925.1406,130.0469 925.4063,129.8125 Q925.6719,129.5781 926.2813,129.5781 L931.4219,129.5781 Q932.0313,129.5781 932.2969,129.8125 Q932.5625,130.0469 932.5625,130.4219 Q932.5625,130.8125 932.2969,131.0469 Q932.0313,131.2813 931.4219,131.2813 L929.7031,131.2813 Z " fill="#000000"/><ellipse cx="954.25" cy="134.1406" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="307" x="960.25" y="139.4941">SymmetricCryptoTransactionManagerFactorySpi</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="581" x2="1603" y1="150.6406" y2="150.6406"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="581" x2="1603" y1="158.6406" y2="158.6406"/><ellipse cx="591" cy="171.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="239" x="600" y="175.3145">boolean isExtendedModeSupported ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="600" y="190.9551"> </text><ellipse cx="591" cy="203.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="998" x="600" y="206.5957">SymmetricCryptoTransactionManagerSpi createTransactionManager (byte[] cardKeyDiversifier, boolean useExtendedMode, List&lt;byte[]&gt; transactionAuditData)</text></g><!--MD5=[1faf4190d52f0dec5aa33ffdfed48092]
class SymmetricCryptoTransactionManagerSpi--><g id="elem_SymmetricCryptoTransactionManagerSpi"><rect codeLine="60" fill="#FEFECE" height="376.4531" id="SymmetricCryptoTransactionManagerSpi" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="860" x="630" y="289.6406"/><ellipse cx="920.75" cy="305.6406" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M921.7031,302.2813 L921.7031,308.9375 L923.4219,308.9375 Q924.0313,308.9375 924.2969,309.1719 Q924.5625,309.4063 924.5625,309.7969 Q924.5625,310.1719 924.2969,310.4063 Q924.0313,310.6406 923.4219,310.6406 L918.2813,310.6406 Q917.6719,310.6406 917.4063,310.4063 Q917.1406,310.1719 917.1406,309.7813 Q917.1406,309.4063 917.4063,309.1719 Q917.6719,308.9375 918.2813,308.9375 L920,308.9375 L920,302.2813 L918.2813,302.2813 Q917.6719,302.2813 917.4063,302.0469 Q917.1406,301.8125 917.1406,301.4219 Q917.1406,301.0469 917.4063,300.8125 Q917.6719,300.5781 918.2813,300.5781 L923.4219,300.5781 Q924.0313,300.5781 924.2969,300.8125 Q924.5625,301.0469 924.5625,301.4219 Q924.5625,301.8125 924.2969,302.0469 Q924.0313,302.2813 923.4219,302.2813 L921.7031,302.2813 Z " fill="#000000"/><ellipse cx="946.25" cy="305.1406" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="259" x="952.25" y="310.4941">SymmetricCryptoTransactionManagerSpi</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="631" x2="1489" y1="321.6406" y2="321.6406"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="631" x2="1489" y1="329.6406" y2="329.6406"/><ellipse cx="641" cy="342.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269" x="650" y="346.3145">byte[] initTerminalSecureSessionContext ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="361.9551"> </text><ellipse cx="641" cy="374.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="525" x="650" y="377.5957">void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)</text><ellipse cx="641" cy="389.8828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="328" x="650" y="393.2363">byte[] updateTerminalSessionMac (byte[] cardApdu)</text><ellipse cx="641" cy="405.5234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="227" x="650" y="408.877">byte[] finalizeTerminalSessionMac ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="424.5176"> </text><ellipse cx="641" cy="436.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="241" x="650" y="440.1582">byte[] generateTerminalSessionMac ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="455.7988"> </text><ellipse cx="641" cy="468.0859" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="650" y="471.4395">void activateEncryption ()</text><ellipse cx="641" cy="483.7266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="650" y="487.0801">void deactivateEncryption ()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="502.7207"> </text><ellipse cx="641" cy="515.0078" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="360" x="650" y="518.3613">boolean isCardSessionMacValid (byte[] cardSessionMac)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="534.002"> </text><ellipse cx="641" cy="546.2891" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="472" x="650" y="549.6426">void computeSvCommandSecurityData (SvCommandSecurityDataApi data)</text><ellipse cx="641" cy="561.9297" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="292" x="650" y="565.2832">boolean isCardSvMacValid (byte[] cardSvMac)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="580.9238"> </text><ellipse cx="641" cy="593.2109" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="526" x="650" y="596.5645">byte[] cipherPinForPresentation (byte[] cardChallenge, byte[] pin, Byte kif, Byte kvc)</text><ellipse cx="641" cy="608.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="659" x="650" y="612.2051">byte[] cipherPinForModification (byte[] cardChallenge, byte[] currentPin, byte[] newPin, Byte kif, Byte kvc)</text><ellipse cx="641" cy="624.4922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="834" x="650" y="627.8457">byte[] generateCipheredCardKey (byte[] cardChallenge, byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="650" y="643.4863"> </text><ellipse cx="641" cy="655.7734" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="650" y="659.127">void synchronize ()</text></g><!--MD5=[ed6cd72910c1e7c5421683689620b946]
class SymmetricCryptoException--><g id="elem_SymmetricCryptoException"><rect codeLine="83" fill="#FEFECE" height="88.5625" id="SymmetricCryptoException" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="422" x="644" y="726.6406"/><ellipse cx="761.25" cy="747.2813" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M764.0156,743.1563 Q764.1719,742.9375 764.3594,742.8281 Q764.5469,742.7188 764.7656,742.7188 Q765.1406,742.7188 765.375,742.9844 Q765.6094,743.2344 765.6094,743.8438 L765.6094,745.2969 Q765.6094,745.9063 765.375,746.1719 Q765.1406,746.4375 764.7656,746.4375 Q764.4219,746.4375 764.2188,746.2344 Q764.0156,746.0469 763.9063,745.5313 Q763.8594,745.1719 763.6719,744.9844 Q763.3438,744.6094 762.7344,744.3906 Q762.125,744.1719 761.5,744.1719 Q760.7344,744.1719 760.0938,744.5 Q759.4688,744.8281 758.9688,745.5781 Q758.4844,746.3281 758.4844,747.3594 L758.4844,748.4531 Q758.4844,749.6875 759.375,750.5156 Q760.2656,751.3281 761.8594,751.3281 Q762.7969,751.3281 763.4531,751.0781 Q763.8438,750.9219 764.2656,750.4844 Q764.5313,750.2188 764.6719,750.1406 Q764.8281,750.0625 765.0313,750.0625 Q765.3594,750.0625 765.6094,750.3281 Q765.875,750.5781 765.875,750.9219 Q765.875,751.2656 765.5313,751.6719 Q765.0313,752.25 764.2344,752.5781 Q763.1563,753.0313 761.8594,753.0313 Q760.3438,753.0313 759.1406,752.4063 Q758.1563,751.9063 757.4688,750.8438 Q756.7813,749.7656 756.7813,748.4844 L756.7813,747.3281 Q756.7813,746 757.3906,744.8594 Q758.0156,743.7031 759.1094,743.0938 Q760.2031,742.4688 761.4375,742.4688 Q762.1719,742.4688 762.8125,742.6406 Q763.4688,742.7969 764.0156,743.1563 Z " fill="#000000"/><ellipse cx="786.75" cy="746.7813" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="830.25" y="744.3145">&lt;&lt;Exception&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="792.75" y="759.9551">SymmetricCryptoException</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="645" x2="1065" y1="767.9219" y2="767.9219"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="645" x2="1065" y1="775.9219" y2="775.9219"/><ellipse cx="655" cy="789.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="280" x="664" y="792.5957">SymmetricCryptoException (String message)</text><ellipse cx="655" cy="804.8828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="396" x="664" y="808.2363">SymmetricCryptoException (String message, Throwable cause)</text></g><!--MD5=[dc78e81cea955f8614ec1504e52d6421]
class SymmetricCryptoIOException--><g id="elem_SymmetricCryptoIOException"><rect codeLine="87" fill="#FEFECE" height="88.5625" id="SymmetricCryptoIOException" rx="2.5" ry="2.5" style="stroke:#D4AC0D;stroke-width:2.0;" width="436" x="1101" y="726.6406"/><ellipse cx="1218.25" cy="747.2813" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1221.0156,743.1563 Q1221.1719,742.9375 1221.3594,742.8281 Q1221.5469,742.7188 1221.7656,742.7188 Q1222.1406,742.7188 1222.375,742.9844 Q1222.6094,743.2344 1222.6094,743.8438 L1222.6094,745.2969 Q1222.6094,745.9063 1222.375,746.1719 Q1222.1406,746.4375 1221.7656,746.4375 Q1221.4219,746.4375 1221.2188,746.2344 Q1221.0156,746.0469 1220.9063,745.5313 Q1220.8594,745.1719 1220.6719,744.9844 Q1220.3438,744.6094 1219.7344,744.3906 Q1219.125,744.1719 1218.5,744.1719 Q1217.7344,744.1719 1217.0938,744.5 Q1216.4688,744.8281 1215.9688,745.5781 Q1215.4844,746.3281 1215.4844,747.3594 L1215.4844,748.4531 Q1215.4844,749.6875 1216.375,750.5156 Q1217.2656,751.3281 1218.8594,751.3281 Q1219.7969,751.3281 1220.4531,751.0781 Q1220.8438,750.9219 1221.2656,750.4844 Q1221.5313,750.2188 1221.6719,750.1406 Q1221.8281,750.0625 1222.0313,750.0625 Q1222.3594,750.0625 1222.6094,750.3281 Q1222.875,750.5781 1222.875,750.9219 Q1222.875,751.2656 1222.5313,751.6719 Q1222.0313,752.25 1221.2344,752.5781 Q1220.1563,753.0313 1218.8594,753.0313 Q1217.3438,753.0313 1216.1406,752.4063 Q1215.1563,751.9063 1214.4688,750.8438 Q1213.7813,749.7656 1213.7813,748.4844 L1213.7813,747.3281 Q1213.7813,746 1214.3906,744.8594 Q1215.0156,743.7031 1216.1094,743.0938 Q1217.2031,742.4688 1218.4375,742.4688 Q1219.1719,742.4688 1219.8125,742.6406 Q1220.4688,742.7969 1221.0156,743.1563 Z " fill="#000000"/><ellipse cx="1243.75" cy="746.7813" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1294.25" y="744.3145">&lt;&lt;Exception&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="1249.75" y="759.9551">SymmetricCryptoIOException</text><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="1102" x2="1536" y1="767.9219" y2="767.9219"/><line style="stroke:#D4AC0D;stroke-width:2.0;" x1="1102" x2="1536" y1="775.9219" y2="775.9219"/><ellipse cx="1112" cy="789.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294" x="1121" y="792.5957">SymmetricCryptoIOException (String message)</text><ellipse cx="1112" cy="804.8828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="410" x="1121" y="808.2363">SymmetricCryptoIOException (String message, Throwable cause)</text></g><!--MD5=[de96a5dbaa5c5ef9677e1bc26a5a7473]
link SymmetricCryptoTransactionManagerFactorySpi to SymmetricCryptoTransactionManagerSpi--><g id="link_SymmetricCryptoTransactionManagerFactorySpi_SymmetricCryptoTransactionManagerSpi"><path codeLine="133" d="M1087.17,213.8106 C1085.13,233.6006 1082.6,258.0996 1079.91,284.1166 " fill="none" id="SymmetricCryptoTransactionManagerFactorySpi-to-SymmetricCryptoTransactionManagerSpi" style="stroke:#3498DB;stroke-width:2.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#3498DB" points="1079.37,289.3386,1084.2749,280.798,1079.8845,284.3652,1076.3173,279.9748,1079.37,289.3386" style="stroke:#3498DB;stroke-width:2.0;"/><polygon fill="#000000" points="1087.4864,256.8759,1091.3389,248.1805,1085.4921,247.5768,1087.4864,256.8759" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="1097" y="256.4092">provide</text></g><!--MD5=[7e5f7722ad5fb9718b512270be165506]
reverse link SvCommandSecurityDataApi to SymmetricCryptoTransactionManagerSpi--><g id="link_SvCommandSecurityDataApi_SymmetricCryptoTransactionManagerSpi"><path codeLine="135" d="M553.492,477.6406 C578.387,477.6406 604.009,477.6406 629.886,477.6406 " fill="none" id="SvCommandSecurityDataApi-backto-SymmetricCryptoTransactionManagerSpi" style="stroke:#27AE60;stroke-width:2.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#27AE60" points="548.191,477.6406,557.191,481.6406,553.191,477.6406,557.191,473.6406,548.191,477.6406" style="stroke:#27AE60;stroke-width:2.0;"/><polygon fill="#000000" points="571,466.9023,580.0451,469.8413,580.0451,463.9634,571,466.9023" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="585" y="471.4092">use</text></g><!--MD5=[20df3513a866a92a4fec23a94209879e]
link SymmetricCryptoTransactionManagerSpi to SymmetricCryptoException--><!--MD5=[5a9de831ed687af60f8ef6770f3cfd28]
link SymmetricCryptoTransactionManagerSpi to SymmetricCryptoIOException--><!--MD5=[8469462f5f62d45aa3fbd5361be55c27]
@startuml
title
    Calypsonet - calypsonet-terminal-calypso-crypto-symmetric-java-api - 0.1.+ (2022-11-29)
end title

' == THEME ==

'Couleurs issues de : https://htmlcolorcodes.com/fr/tableau-de-couleur/tableau-de-couleur-design-plat/
!define C_GREY1 F8F9F9
!define C_GREY2 F2F3F4
!define C_GREY3 E5E7E9
!define C_GREY4 D7DBDD
!define C_GREY5 CACFD2
!define C_GREY6 BDC3C7
!define C_LINK 3498DB
!define C_USE 27AE60

' - - Styles that don't work with new version of plantuml - -
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
' - - END - -

skinparam ClassBorderThickness 2
skinparam ArrowThickness 2

' Yellow
skinparam ClassBackgroundColor #FEFECE
skinparam ClassBorderColor #D4AC0D
' Red
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
' Purple
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
' blue
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
' Green
skinparam ClassBackgroundColor<<green>> #E9F7EF
skinparam ClassBorderColor<<green>> #27AE60
hide <<green>> stereotype
' Grey
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

' == CONTENT ==

package "org.calypsonet.terminal.calypso.crypto.symmetric" as api {
    package spi {
        +interface SymmetricCryptoTransactionManagerFactorySpi {
            +boolean isExtendedModeSupported ()
    
            +SymmetricCryptoTransactionManagerSpi createTransactionManager (byte[] cardKeyDiversifier, boolean useExtendedMode, List<byte[]> transactionAuditData)
        }
        +interface SymmetricCryptoTransactionManagerSpi {
            +byte[] initTerminalSecureSessionContext ()
    
            +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)
            +byte[] updateTerminalSessionMac (byte[] cardApdu)
            +byte[] finalizeTerminalSessionMac ()
    
            +byte[] generateTerminalSessionMac ()
    
            +void activateEncryption ()
            +void deactivateEncryption ()
    
            +boolean isCardSessionMacValid (byte[] cardSessionMac)
    
            +void computeSvCommandSecurityData (SvCommandSecurityDataApi data)
            +boolean isCardSvMacValid (byte[] cardSvMac)
    
            +byte[] cipherPinForPresentation (byte[] cardChallenge, byte[] pin, Byte kif, Byte kvc)
            +byte[] cipherPinForModification (byte[] cardChallenge, byte[] currentPin, byte[] newPin, Byte kif, Byte kvc)
            +byte[] generateCipheredCardKey (byte[] cardChallenge, byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)

            +void synchronize ()
        }
        +class "<<Exception>>\nSymmetricCryptoException" as SymmetricCryptoException {
            +SymmetricCryptoException (String message)
            +SymmetricCryptoException (String message, Throwable cause)
        }
        +class "<<Exception>>\nSymmetricCryptoIOException" as SymmetricCryptoIOException {
            +SymmetricCryptoIOException (String message)
            +SymmetricCryptoIOException (String message, Throwable cause)
        }
    }
    +interface SvCommandSecurityDataApi {
        +byte[] getSvGetRequest ()
        +byte[] getSvGetResponse ()
        +byte[] getSvCommandPartialRequest ()

        +SvCommandSecurityDataApi setSerialNumber (byte[] serialNumber)
        +SvCommandSecurityDataApi setTransactionNumber (byte[] transactionNumber)
        +SvCommandSecurityDataApi setTerminalChallenge (byte[] terminalChallenge)
        +SvCommandSecurityDataApi setTerminalSvMac (byte[] terminalSvMac)
    }

'
'    +interface SymmetricCryptoTransactionManagerFactorySpiDesignByUseCase {
'        +byte[] initTerminalSecureSessionContext (byte[] keyDiversifier)
'
'        +byte[] computeTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc, List<byte[]> cardApdus)
'        +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)
'        +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc, List<byte[]> cardApdus)
'        +void updateTerminalSessionMac (List<byte[]> cardApdus)
'        +byte[] updateTerminalSessionMacEncrypted (byte[] cardApdu)
'        +byte[] finalizeTerminalSessionMac (List<byte[]> cardApdus)
'        +byte[] finalizeTerminalSessionMac ()
'
'        +<s>byte[] generateTerminalSessionMac ()
'
'        +boolean verifyCardSessionMac (byte[] cardSessionMac)
'
'        +void generateSvCommandSecurityData (SvCommandSecurityDataApi SvCommandSecurityDataApi)
'        +void generateSvCommandSecurityData (byte[] cardSerial, SvCommandSecurityDataApi SvCommandSecurityDataApi)
'        +boolean verifyCardSvMac (byte[] cardSvMac)
'        +boolean verifyCardSessionAndSvMac (byte[] cardSessionMac, byte[] cardSvMac)
'
'        +byte[] cipherPinForPresentation (byte[] openSecureSessionDataOut, byte kif, byte kvc, List<byte[]> cardApdus, byte[] cardSerial, byte[] cardChallenge, byte[] pin, byte kif, byte kvc)
'        +byte[] cipherPinForPresentation (byte[] cardSerial, byte[] cardChallenge, byte[] pin, byte kif, byte kvc)
'        +byte[] cipherPinForModification (byte[] cardSerial, byte[] cardChallenge, byte[] currentPin, byte[] newPin, byte kif, byte kvc)
'        +byte[] generateCardKey (byte[] cardSerial, byte[] cardChallenge, byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)
'    }
}

' Associations

SymmetricCryptoTransactionManagerFactorySpi ..> SymmetricCryptoTransactionManagerSpi #C_LINK : provide >

SymmetricCryptoTransactionManagerSpi .left.> SvCommandSecurityDataApi #C_USE : use >

' == LAYOUT ==

SymmetricCryptoTransactionManagerSpi -[hidden]- SymmetricCryptoException
SymmetricCryptoTransactionManagerSpi -[hidden]- SymmetricCryptoIOException

' == STYLE ==

package api #C_GREY1 {}
package spi #C_GREY2 {}

interface SvCommandSecurityDataApi <<purple>>

@enduml

@startuml
title
    Calypsonet - calypsonet-terminal-calypso-crypto-symmetric-java-api - 0.1.+ (2022-11-29)
end title



skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF

skinparam ClassBorderThickness 2
skinparam ArrowThickness 2

skinparam ClassBackgroundColor #FEFECE
skinparam ClassBorderColor #D4AC0D
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
skinparam ClassBackgroundColor<<green>> #E9F7EF
skinparam ClassBorderColor<<green>> #27AE60
hide <<green>> stereotype
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype


package "org.calypsonet.terminal.calypso.crypto.symmetric" as api {
    package spi {
        +interface SymmetricCryptoTransactionManagerFactorySpi {
            +boolean isExtendedModeSupported ()
    
            +SymmetricCryptoTransactionManagerSpi createTransactionManager (byte[] cardKeyDiversifier, boolean useExtendedMode, List<byte[]> transactionAuditData)
        }
        +interface SymmetricCryptoTransactionManagerSpi {
            +byte[] initTerminalSecureSessionContext ()
    
            +void initTerminalSessionMac (byte[] openSecureSessionDataOut, byte kif, byte kvc)
            +byte[] updateTerminalSessionMac (byte[] cardApdu)
            +byte[] finalizeTerminalSessionMac ()
    
            +byte[] generateTerminalSessionMac ()
    
            +void activateEncryption ()
            +void deactivateEncryption ()
    
            +boolean isCardSessionMacValid (byte[] cardSessionMac)
    
            +void computeSvCommandSecurityData (SvCommandSecurityDataApi data)
            +boolean isCardSvMacValid (byte[] cardSvMac)
    
            +byte[] cipherPinForPresentation (byte[] cardChallenge, byte[] pin, Byte kif, Byte kvc)
            +byte[] cipherPinForModification (byte[] cardChallenge, byte[] currentPin, byte[] newPin, Byte kif, Byte kvc)
            +byte[] generateCipheredCardKey (byte[] cardChallenge, byte issuerKeyKif, byte issuerKeyKvc, byte targetKeyKif, byte targetKeyKvc)

            +void synchronize ()
        }
        +class "<<Exception>>\nSymmetricCryptoException" as SymmetricCryptoException {
            +SymmetricCryptoException (String message)
            +SymmetricCryptoException (String message, Throwable cause)
        }
        +class "<<Exception>>\nSymmetricCryptoIOException" as SymmetricCryptoIOException {
            +SymmetricCryptoIOException (String message)
            +SymmetricCryptoIOException (String message, Throwable cause)
        }
    }
    +interface SvCommandSecurityDataApi {
        +byte[] getSvGetRequest ()
        +byte[] getSvGetResponse ()
        +byte[] getSvCommandPartialRequest ()

        +SvCommandSecurityDataApi setSerialNumber (byte[] serialNumber)
        +SvCommandSecurityDataApi setTransactionNumber (byte[] transactionNumber)
        +SvCommandSecurityDataApi setTerminalChallenge (byte[] terminalChallenge)
        +SvCommandSecurityDataApi setTerminalSvMac (byte[] terminalSvMac)
    }

}


SymmetricCryptoTransactionManagerFactorySpi ..> SymmetricCryptoTransactionManagerSpi #3498DB : provide >

SymmetricCryptoTransactionManagerSpi .left.> SvCommandSecurityDataApi #27AE60 : use >


SymmetricCryptoTransactionManagerSpi -[hidden]- SymmetricCryptoException
SymmetricCryptoTransactionManagerSpi -[hidden]- SymmetricCryptoIOException


package api #F8F9F9 {}
package spi #F2F3F4 {}

interface SvCommandSecurityDataApi <<purple>>

@enduml

PlantUML version 1.2022.12(Sun Oct 23 20:12:26 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>